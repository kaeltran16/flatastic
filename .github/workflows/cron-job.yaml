name: Call API routinely
on:
  schedule:
    # Run at 00:05 GMT+7 (17:05 UTC) - after end of day in Vietnam timezone
    # This ensures templates due "today" (23:59:59 GMT+7) are picked up
    - cron: '5 17 * * *'
    # Run again at 08:00 GMT+7 (01:00 UTC) as a morning check
    - cron: '0 1 * * *'

  workflow_dispatch:

jobs:
  trigger-webhooks:
    runs-on: ubuntu-latest
    steps:
      - name: Call update-overdue-chore-status
        run: |
          curl -X GET https://flatastic02.vercel.app/api/webhooks/update-overdue-chore-status \
            -H "x-webhook-secret: ${{ secrets.WEBHOOK_SECRET }}"

      - name: Call chore-reminder
        run: |
          curl -X GET https://flatastic02.vercel.app/api/webhooks/chore-reminder \
            -H "x-webhook-secret: ${{ secrets.WEBHOOK_SECRET }}"

      - name: Call auto-create-recurring-chores
        run: |
          curl -X GET https://flatastic02.vercel.app/api/webhooks/auto-create-recurring-chores \
            -H "x-webhook-secret: ${{ secrets.WEBHOOK_SECRET }}"
