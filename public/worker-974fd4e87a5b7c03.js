(()=>{async function e(){try{if(!navigator.onLine)return void console.log("Still offline, skipping sync");console.log("Performing background sync...")}catch(e){throw console.error("Background sync failed:",e),e}}self.addEventListener("install",e=>{console.log("Service Worker installing..."),self.skipWaiting()}),self.addEventListener("activate",e=>{console.log("Service Worker activating..."),e.waitUntil(self.clients.claim())}),self.addEventListener("push",function(e){if(console.log("Push event received:",e),e.data)try{let t=e.data.json();console.log("Push data:",t);let i={body:t.body||"New notification",icon:t.icon||"/web-app-manifest-192x192.png",badge:t.badge||"/web-app-manifest-192x192.png",image:t.image,vibrate:t.vibrate||[100,50,100],tag:t.tag||"general",requireInteraction:t.requireInteraction||!1,actions:t.actions||[],data:{dateOfArrival:Date.now(),primaryKey:t.primaryKey||"1",url:t.url||"/",...t.data}};e.waitUntil(self.registration.showNotification(t.title||"Notification",i))}catch(t){console.error("Error processing push event:",t),e.waitUntil(self.registration.showNotification("New Notification",{body:"You have a new notification",icon:"/web-app-manifest-192x192.png",badge:"/web-app-manifest-192x192.png"}))}}),self.addEventListener("notificationclick",function(e){var t;console.log("Notification click received:",e),e.notification.close();let i=(null==(t=e.notification.data)?void 0:t.url)||"/";if(e.action)switch(console.log("Action clicked:",e.action),e.action){case"view":break;case"dismiss":return}e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){for(let t=0;t<e.length;t++){let n=e[t];if(n.url===i&&"focus"in n)return n.focus()}if(clients.openWindow)return clients.openWindow(i)}))}),self.addEventListener("sync",function(t){console.log("Background sync event:",t.tag),"background-sync"===t.tag&&t.waitUntil(e())}),self.addEventListener("message",function(e){console.log("Message received from client:",e.data),e.data&&"TEST_NOTIFICATION"===e.data.type&&self.registration.showNotification("Service Worker Test",{body:e.data.message||"Test notification",icon:"/web-app-manifest-192x192.png",tag:"sw-test",data:{url:"/",test:!0}}).then(()=>{var t;null==(t=e.ports[0])||t.postMessage({success:!0})}).catch(t=>{var i;console.error("Test notification failed:",t),null==(i=e.ports[0])||i.postMessage({success:!1,error:t.message})})}),console.log("Service Worker loaded")})();